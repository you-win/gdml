<script>
extends Node2D

func _ready():
    Physics2DServer.area_set_param(get_world_2d().space, Physics2DServer.AREA_PARAM_GRAVITY_VECTOR, Vector2.ZERO)
    queue_free()
</script>

<canvas_layer>
    <gdml style="anchor_left: 0.4; anchor_right: 0.6; anchor_bottom: 0.9;margin_top: 10;size_flags_horizontal: (int) 3; size_flags_vertical: (int) 3;">
        <label style="align: (int) 1" name="ScoreDisplay">
            <script>
extends Label

func _ready():
    var tree = get_tree()
    yield(tree, "idle_frame")

    var ball_vis = tree.root.find_node("BallVis", true, false)
    ball_vis.connect("screen_exited", self, "_on_vis_exit")

func _on_vis_exit() -> void:
    text = "ball is gone!"

            </script>
            score placeholder
        </label>
    </gdml>
</canvas_layer>

<camera_2_d props="current: (bool)true"/>
<kinematic_body_2_d name="LeftPaddle" props="position:x: (int)-200">
    <visibility_notifier_2_d name="LeftPaddleVis"/>
    <script>
extends KinematicBody2D

var test_var = 1

func _ready():
    var cs = CollisionShape2D.new()
    var rect = RectangleShape2D.new()
    rect.extents = Vector2(32, 32)
    cs.shape = rect
    add_child(cs)

    var sprite = Sprite.new()
    var image = Image.new()
    <!-- TODO make this portable aka not a res path -->
    image.load("res://icon.png")
    var image_texture = ImageTexture.new()
    image_texture.create_from_image(image)
    sprite.texture = image_texture
    add_child(sprite)

    scale.y = 3

func _physics_process(delta):
    if Input.is_key_pressed(KEY_W):
        position.y -= 10
    if Input.is_key_pressed(KEY_S):
        position.y += 10

    </script>
</kinematic_body_2_d>
<kinematic_body_2_d name="RightPaddle" props="position:x: (int) 200">
    <visibility_notifier_2_d name="RightPaddleVis"/>
    <script>
extends KinematicBody2D

func _ready():
    var cs = CollisionShape2D.new()
    var rect = RectangleShape2D.new()
    rect.extents = Vector2(32, 32)
    cs.shape = rect
    add_child(cs)

    var sprite = Sprite.new()
    var image = Image.new()
    image.load("res://icon.png")
    var image_texture = ImageTexture.new()
    image_texture.create_from_image(image)
    sprite.texture = image_texture
    add_child(sprite)

    scale.y = 3

func _physics_process(delta):
    if Input.is_key_pressed(KEY_UP):
        position.y -= 10
    if Input.is_key_pressed(KEY_DOWN):
        position.y += 10

    </script>
</kinematic_body_2_d>
<rigid_body_2_d name="Ball">
    <visibility_notifier_2_d name="BallVis"/>
    <script>
extends RigidBody2D

func _ready():
    var cs = CollisionShape2D.new()
    var rect = RectangleShape2D.new()
    rect.extents = Vector2(32, 32)
    cs.shape = rect
    add_child(cs)

    var pm = PhysicsMaterial.new()
    pm.friction = 0.0
    pm.bounce = 1.0

    physics_material_override = pm

    var sprite = Sprite.new()
    var image = Image.new()
    image.load("res://icon.png")
    var image_texture = ImageTexture.new()
    image_texture.create_from_image(image)
    sprite.texture = image_texture
    add_child(sprite)

    apply_central_impulse(Vector2(-200, 0))

    </script>
</rigid_body_2_d>

